import React from 'react';
import tinycolor from 'tinycolor2';

class CharacterView extends React.Component {

  constructor() {
    super();    
    this.insertCharacterStyle = this.insertCharacterStyle.bind(this);
    this.updateCharacterStyle = this.updateCharacterStyle.bind(this);
    this.skinArray = [
      ['#e9c6af','#e1c27d','#DB9065','#A57257','#5C3836'],
      ['#FFD4D6','#B97C6D','#C8F0CC','#80968C','#666876'],
      ['#E3C69A','#DEC67D','#D1AC7B','#9E8251','#8F6531'],
      ['#E9BFBA','#E5BC9D','#E9AE99','#C78D7F','#BD7878'],
      ['#78B03A','#B29951','#A15830','#6A8051','#727D55']
    ];
  }

  componentDidMount() {
    this.props.character.set({'style': document.createElement('style')});
    const style = this.props.character.get('style');
    document.getElementById(`${this.props.characterId}`).appendChild(style);
    this.insertCharacterStyle(style);
  }

  componentWillUpdate() {
    this.updateCharacterStyle();
  }

  insertCharacterStyle(style) {
    const skinColor = this.skinArray[this.props.character.get('race')][this.props.character.get('skin')];
    const muscle = this.props.character.get('strenght');

    style.sheet.insertRule(`#${this.props.characterId} .base { fill : ${tinycolor(skinColor).toString()}; stroke : ${tinycolor(skinColor).darken(75).toString()}; }`, 0);
    style.sheet.insertRule(`#${this.props.characterId} .shadow { fill : ${tinycolor(skinColor).darken().toString()}; }`, 0);
    style.sheet.insertRule(`#${this.props.characterId} .muscle { stroke : ${tinycolor(skinColor).desaturate().darken(30).setAlpha(muscle).toString()}; stroke-width:${(muscle*1.5)+2}px; }`, 0);
  }

  updateCharacterStyle() {
    const style = this.props.character.get('style');
    console.log(style.sheet.rules[0].style.fill)
    const skinColor = this.skinArray[this.props.character.get('race')][this.props.character.get('skin')];
    const muscle = this.props.character.get('strenght');

    style.sheet.rules[2].style.fill = tinycolor(skinColor).toString();
    style.sheet.rules[2].style.stroke = tinycolor(skinColor).darken(75).toString();
    style.sheet.rules[1].style.fill = tinycolor(skinColor).darken().toString();
    style.sheet.rules[0].style.stroke = tinycolor(skinColor).desaturate().darken(30).setAlpha(muscle).toString();
    style.sheet.rules[0].style.strokeWidth = `${(muscle*1.5)+2}px;`;
  }

  render() {
    var leftEarPath, rightEarPath, raceClass;
    switch (this.props.character.get('race')) {
      case 0:
        leftEarPath = "m 39.591259,12.26598 c 0.521219,-4.615404 4.102478,-1.720799 2.639739,-0.139226 -0.125985,0.49782 -0.496031,1.618345 -2.414367,2.044501 -1.28911,0.286374 -0.495042,-1.889499 -0.225372,-1.905275 z";
        rightEarPath = "M 29.535854,12.372535 C 29.425725,8.0674344 26.046243,9.8829397 27.278189,11.66441 c -0.001,-0.005 -1.061681,0.574365 1.862094,2.423491 1.036102,0.655277 0.644869,-1.675961 0.395571,-1.715366 z";
        raceClass = "human";
        break;
      case 1:
        rightEarPath = "m 29.625122,11.204607 c -1.067309,-0.411981 -3.987718,-3.073574 -3.987718,-3.073574 0,0 1.453587,6.66475 4.273552,5.843759 2.819964,-0.820989 -0.285834,-2.770185 -0.285834,-2.770185 z";
        leftEarPath = "m 39.709242,11.634346 c 1.06066,-0.397748 3.977476,-3.0052043 3.977476,-3.0052043 0,0 -1.502602,6.5849323 -4.286835,5.7452423 -2.784233,-0.839689 0.309359,-2.740038 0.309359,-2.740038 z";
        raceClass = "elf";
        break;
      case 2:
        leftEarPath = "m 39.591259,12.26598 c 0.521219,-4.615404 4.102478,-1.720799 2.639739,-0.139226 -0.125985,0.49782 -0.496031,1.618345 -2.414367,2.044501 -1.28911,0.286374 -0.495042,-1.889499 -0.225372,-1.905275 z";
        rightEarPath = "M 29.535854,12.372535 C 29.425725,8.0674344 26.046243,9.8829397 27.278189,11.66441 c -0.001,-0.005 -1.061681,0.574365 1.862094,2.423491 1.036102,0.655277 0.644869,-1.675961 0.395571,-1.715366 z";
        raceClass = "dwarf";
        break;
      case 3:
        rightEarPath = "m 29.625122,11.204607 c -1.067309,-0.411981 -2.326515,-1.066287 -2.326515,-1.066287 0,0 -0.207616,4.657463 2.612349,3.836472 2.819964,-0.820989 -0.285834,-2.770185 -0.285834,-2.770185 z";
        leftEarPath = "m 40.228368,11.495912 c 1.06066,-0.397748 2.247056,-1.413217 2.247056,-1.413217 0,0 -0.291308,5.131379 -3.075541,4.291689 -2.784233,-0.839689 0.828485,-2.878472 0.828485,-2.878472 z";
        raceClass = "hobbit";
        break;
      case 4:
        rightEarPath = "m 29.025139,11.191084 c -1.014504,-1.5444545 -3.344149,-0.430933 -3.252007,0.569951 1.610161,-0.472692 2.236701,2.515159 3.845261,1.575229 2.026665,-1.184241 -0.593254,-2.145175 -0.593254,-2.145175 z";
        leftEarPath = "m 39.709242,11.634346 c 0.941448,-2.086793 4.00823,-1.176654 4.089834,0.06592 -2.061982,-0.265729 -2.248441,3.511873 -4.399193,2.674121 -2.709786,-1.055505 0.309359,-2.740038 0.309359,-2.740038 z";
        raceClass = "orc";
        break;
    }
    return (
      <svg id={this.props.characterId} className="character" xmlns="http://www.w3.org/2000/svg" width="100%" viewBox={this.props.viewBox}>
        <g
           id="Character-Male"
           className={raceClass}>
          <g
            id="Body">
            <g
               id="Inferior-Members">
              <g
                 id="RightLeg">
                <path
                   d="m 27.202291,33.164943 c 0,0 0.835672,7.263916 -0.192847,10.478037 1.028519,3.599817 0.257129,8.099587 0.257129,8.099587 -0.194921,0.0882 -6.966292,3.79519 4.049793,2.442733 3.17738,-10.90686 0.0068,-10.779143 -0.06428,-10.79945 0.259575,0.519149 3.375038,-5.463588 2.699863,-9.25667 -4.34131,-4.909375 -6.74946,-0.964957 -6.749658,-0.964237 z"
                   id="RightLeg-Base"
                   vectorEffect="non-scaling-stroke"
                   className="base"
                   />
                <path
                   d="m 29.902153,32.329272 c 0,0 0.835672,10.092342 -0.25713,10.992296 0.707107,2.63558 0.449977,8.356717 -0.257129,9.192388 1.414213,1.157084 1.283906,1.098285 1.478496,1.157084 0.184238,0.05567 2.690908,-8.87993 0,-10.156624 1.414213,-2.571298 3.021274,-6.749656 2.571297,-9.063824 -2.63558,-2.249885 -3.214122,-2.057038 -3.535534,-2.12132 z"
                   id="RightLeg-Shadow"
                   vectorEffect="non-scaling-stroke"
                   className="shadow"
                   />
                <path
                   d="m 30.159283,35.800523 c 0,0 0.25713,4.564053 0,6.106832 m -0.321412,3.085557 c -0.02714,0.544348 0.168598,3.575262 1.221366,2.956992"
                   id="RightLeg-Muscle"
                   vectorEffect="non-scaling-stroke"
                   className="muscle"
                   />
              </g>
              <g
                 id="LeftLeg"
              >
                <path
                   d="m 31.252084,36.957607 c 0,0 3.599817,7.971022 3.599817,12.985052 2.571297,4.628335 1.542778,10.413754 1.542778,10.413754 -4.397793,3.595264 2.264526,3.346991 5.399725,2.185603 0.257129,-9.385235 -1.799909,-15.684914 -1.799909,-15.684914 0.910485,-1.698813 5.786494,-21.239639 -8.742411,-9.899495 z"
                   id="LeftLeg-Base"
                   vectorEffect="non-scaling-stroke"
                   className="base"
                   />
                <path
                   d="m 35.173313,34.964852 c 0,0 5.528289,9.642365 2.892709,12.40651 1.542779,4.306923 3.599817,12.213662 1.735626,13.113616 1.221366,1.607061 1.478496,1.799908 1.478496,1.799908 0,0 0.321412,-8.613846 -1.799908,-15.427784 2.23837,-7.13535 2.698239,-16.199173 -4.306923,-11.89225 z"
                   id="LeftLeg-Shadow"
                   vectorEffect="non-scaling-stroke"
                   className="shadow"
                   />
                <path
                   d="m 36.394679,37.536149 c 0,0 2.12132,4.049793 2.185603,5.978267 m 0,7.585327 c 0,0 -0.192847,4.306923 1.799908,3.471251"
                   id="LeftLeg-Muscle"
                   vectorEffect="non-scaling-stroke"
                   className="muscle"
                   />
              </g>
            </g>
            <g
               id="Superior-Members">
              <g
                 id="RightArm"
                 className="arm"
                >
                <path
                   d="m 25.59523,17.158617 c 0,0 2.699863,-4.114075 3.985511,2.314168 1.09469,5.473452 -1.671343,6.685373 -1.671343,6.685373 0,0 -0.128565,2.764144 -2.571297,4.885465 0.918929,4.078256 -2.139223,3.926518 -2.185604,3.856946 0,0 -1.028519,1.157084 0.642825,-2.185603 -1.285649,-0.257129 0.557627,3.678127 -1.799908,2.057038 -3.175137,-2.183289 -1.562218,-3.367372 0.642824,-5.528289 0.128565,-2.828427 2.314167,-4.756901 2.314167,-4.756901 -0.08671,0.02891 -0.700358,-3.837767 0.642825,-7.328197 z"
                   id="RightArm-Base"
                   className="base"
                   vectorEffect="non-scaling-stroke"
                   />
                <path
                   d="m 27.073726,16.45151 c 0,0 0.707107,1.864191 0.06428,2.185603 -0.642824,0.321412 1.221367,4.885465 -0.321412,6.492526 -1.092801,2.249885 -2.956992,4.821183 -2.956992,4.821183 l 0.964237,0.642824 c 0,0 2.12132,-0.964236 2.63558,-4.7569 2.161392,-0.869907 2.893765,-8.094327 -0.385693,-9.385236 z"
                   id="RightArm-Shadow"
                   className="shadow"
                   vectorEffect="non-scaling-stroke"
                   />
                <path
                   id="RightArm-Muscle"
                   d="m 25.980925,26.415288 c 0,0 -0.128565,1.028519 -0.835672,1.671343 m 1.799908,-9.25667 c 0,0 0.899954,3.599816 0.128565,5.335442"
                   className="muscle"
                   vectorEffect="non-scaling-stroke"
                   />
              </g>
              <g
                 id="Chest"
                >
                <path
                   d="m 27.845115,16.065816 c 0,0 12.834029,-5.167647 15.234937,3.792664 0.375253,1.400462 -0.975527,2.426366 -0.918667,3.594469 0.04782,0.982295 -3.599749,4.197481 -3.714448,5.018708 -0.62158,4.45039 1.418994,5.528959 1.418994,5.528959 0,0 -8.932332,6.63753 -12.663639,-1.157085 1.542778,-5.142595 1.0928,-5.142595 1.0928,-5.142595 0,0 -2.385737,-4.541741 -0.777603,-8.935739 0.520157,-1.421255 0.135662,-1.25965 0.327626,-2.699381 z"
                   id="Chest-Base"
                   className="base"
                   vectorEffect="non-scaling-stroke"
                   />
                <path
                   d="m 39.287389,15.937251 c 0,0 1.092801,11.185144 -4.306923,11.699403 1.60706,2.699862 0.192845,7.842457 -2.378451,8.485281 7.378888,-1.015882 5.987977,-2.968181 5.849702,-3.214121 0,0 -1.092801,-1.735626 -0.449977,-5.01403 3.278404,-3.535534 5.11759,-6.899264 4.24264,-8.485282 -0.820762,-1.487792 -1.083552,-2.690152 -2.956991,-3.471251 z"
                   id="Chest-Shadow"
                   vectorEffect="non-scaling-stroke"
                   className="shadow" />
                <path
                   id="Chest-Muscle"
                   d="m 29.163065,32.563426 c 0,0 1.192181,0.842391 1.248241,0.0015 0.509752,1.062334 1.087896,1.116554 2.51594,0.801275 m -3.282223,-2.322579 c 0,0 1.157083,0.77139 1.221366,-0.192847 0.584528,1.218169 1.126619,1.1972 2.764145,0.835672 M 28.77721,29.629409 c 0,0 0.417836,0.674966 1.446355,-0.932095 m 2.37845,0.289271 c 0,0 1.735626,2.89271 4.435488,1.349931 m -8.742411,-4.178358 c -0.04466,0.04925 0.37706,1.120961 1.285649,0.964235 m 3.085556,0.06428 c 0,0 4.692618,1.221366 5.656855,-2.057038"
                   vectorEffect="non-scaling-stroke"
                   className="muscle"
                   />
              </g>
              <g
                 id="LeftArm"
                 className="arm"
                 >
                <path
                   d="m 44.944244,20.115609 c 0,0 2.121319,3.471252 -0.707108,10.54232 0.899954,4.371205 -1.157084,7.328197 -1.157084,7.328197 1.061451,2.040864 0.175229,4.804227 -2.442732,5.01403 -7.842457,-4.628334 -0.514259,-1.414213 -0.385694,-3.214122 0.660355,-0.995793 -0.768937,-1.670362 -2.185603,-0.514259 -1.285649,-0.642824 0.128565,-2.828428 2.185602,-2.571298 -0.642824,-3.471251 -0.257129,-4.7569 0.899954,-6.428243 -2.235968,-3.953798 0.106375,-6.241912 -0.808282,-8.209782 -1.109376,-2.386806 1.356547,-7.527711 4.600947,-1.946843 z"
                   vectorEffect="non-scaling-stroke"
                   id="LeftArm-Base"
                   className="base" />
                <path
                   d="m 43.080052,18.572831 c 0,0 0.899954,3.278404 0,3.921228 1.172649,0.763607 1.565218,5.131375 -0.385695,7.713892 0.06893,2.191036 1.452292,5.80163 -1.157083,6.685374 0.385694,0.899954 0.899954,1.092801 0.899954,1.092801 0,0 2.37845,-3.021274 1.157084,-7.39248 1.542778,-3.856946 2.956992,-9.063823 -0.51426,-12.020815 z"
                   vectorEffect="non-scaling-stroke"
                   id="LeftArm-Shadow"
                   className="shadow"
                   />
                <path
                   d="m 42.887205,32.072142 c 0,0 0.642824,2.185603 0.06428,2.699862 M 43.01577,24.10112 c 0,0 1.478496,3.085557 -0.385695,5.142595"
                   vectorEffect="non-scaling-stroke"
                   id="LeftArm-Muscle"
                   className="muscle"
                   />
              </g>
            </g>
          </g>
          <g
             id="Head">
            <path
               id="RightEar"
               d={rightEarPath}
               vectorEffect="non-scaling-stroke"
               className="base"
               />
            <g
               id="Face">
              <path
                 d="m 32.023474,18.444266 c 0,0 -3.728382,-0.365873 -3.728382,-10.7994489 C 34.59477,-2.126113 40.894449,7.3876873 40.894449,7.3876873 40.735418,7.1226362 43.84068,17.140683 32.023474,18.444266 z"
                 id="Face-Base"
                 vectorEffect="non-scaling-stroke"
                 className="base" />
              <path
                 d="m 32.03934,17.747001 c 0,0 5.772727,-3.863637 5.636363,-5.772727 -0.136363,-1.636364 -0.727272,-2.0909093 -1.181818,-3.2272729 2.318182,0.4545455 3.318182,0.3181818 3.863637,-0.9090909 0.545454,-1.2272727 2.136363,9.7727268 -8.318182,9.9090908 z"
                 id="Face-Shadow"
                 vectorEffect="non-scaling-stroke"
                 className="shadow" />
            </g>
            <path
               id="Mouth"
               className="mouth"
               d="m 31.00809,15.406092 c 0,0 1.3125,0.859375 2.40625,0.109375"
               vectorEffect="non-scaling-stroke"
               />
            <g
               id="Hair">
              <path
                 d="m 25.624556,0.6706218 c -2.25,4.1250001 1.539784,5.9229702 1.539784,5.9229702 0,0 -2.5625,2.0625 -2,4.25 4.544657,-4.849893 6.905847,-3.0384221 5.875,-0.75 3.494902,-1.2634721 9.467641,-1.9237632 8.683058,-0.455267 -6.373014,6.620261 1.14069,-1.1345759 2.059359,2.05568 0.349881,-1.647016 0.533797,-2.8735413 0.44486,-3.8421637 C 42.108096,6.5609994 41.504995,5.7281862 40.16434,4.968592 c 0,0 2.0625,0.1875 1.75,-2.125 -2.375,0.4375 -4.5,0.25 -4.5,0.25 0,0 -1.375,-2.875 -5.0625,0.0625 -3.026074,-0.8383741 -7.734241,1.3048749 -6.727284,-2.4854702 z"
                 id="Hair-Base"
                 vectorEffect="non-scaling-stroke"
                 className="hair-base"
                 />
              <path
                 d="m 38.228737,4.386501 c 0,0 -2.961009,0.5303301 -3.469242,-0.6850097 -0.287262,2.0771262 -3.64602,1.4142136 -3.64602,1.4142136 -1.041091,-0.1727741 2.264741,1.2129113 1.856156,1.7235728 -1.660518,2.0753639 -0.331457,1.6793786 -0.331457,1.6793786 0,0 6.275573,-1.4363107 7.490913,-0.2209709 -1.701476,-3.5797281 3.425048,0.3756504 -1.90035,-3.9111844 z"
                 id="Hair-Shadow"
                 vectorEffect="non-scaling-stroke"
                 className="hair-shadow"
                 />
            </g>
            <path
               id="LeftEar"
               d={leftEarPath}
               vectorEffect="non-scaling-stroke"
               className="base"
               />
          </g>
        </g>
      </svg>
    )
  }
}

export default CharacterView;